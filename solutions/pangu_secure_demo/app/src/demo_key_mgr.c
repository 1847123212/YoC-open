#include "app_main.h"
#include "yoc/partition.h"

const uint8_t e_test[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x01,
};

void key_mgr_demo_main()
{
#ifdef CONFIG_SECURITY_DEMO_KEY_MGR
    uint32_t   ret;
    ret = partition_init();
    if (ret <= 0) {
        printf("%s, %d, %x\n", __FUNCTION__, __LINE__, ret);
        return;
    }

    key_handle key_addr;
    uint32_t   key_size;
    for (int i = KM_ID_PUBKEY_E; i <= KM_ID_PUBKEY_E; i++) {
        ret = km_get_key(i, &key_addr, &key_size);
        if (ret == KM_ERR_NOT_EXIST || key_size != sizeof(e_test)) {
            printf("%s, %d, %x\n", __FUNCTION__, __LINE__, ret);
        }
        CHECK_RET_WITHOUT_RET_P(ret ==KM_OK, ret);
        //printf("%s, %d, %x\n", __FUNCTION__, __LINE__, i);
        //aos_log_hexdump("key_id", (char*)key_addr, key_size);
        ret = memcmp((char*)key_addr, e_test, key_size);
        CHECK_RESULT(ret == 0);
    }
#endif
    return;
}