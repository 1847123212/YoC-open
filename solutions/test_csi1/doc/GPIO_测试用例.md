## GPIO
### 概要
该文档主要描述CSI1.0自动化测试框架下GPIO模块的AT测试命令。 文档中所涉及的命令是用来测试GPIO模块的接口工作是否正常、接口返回值是否符合预期和该模块的特性功能是否正常。

### 测试原理
PC主机用USB转串口线连接测试板（以下简称A板）和辅助测试板（以下简称B板），作为PC同A板或B板数据通信，命令收发的通道；同时PC会使用USB线连接A板和B板的HAD调试器，作为程序下载的通道；A板上被测试的GPIO通过杜邦线连接到B板的GPIO。通过PC下发AT指令到A板测试程序，发送AT指令到B板运行辅助测试程序，当A板和B板都有测试成功的信息返回PC后，PC判定本次测试执行通过。

### 测试流程
- 测试前应当连接好A板和B板之间的GPIO引脚
- 发送引脚复用的配置命令（PINMUX_CONFIG）到A板和B板，配置好需要测试的引脚
- 发送GPIO的AT测试命令进行功能测试

### 命令列表
以下是GPIO模块对应的AT测试命令列表及其功能简要介绍。

| AT命令列表                       | 功能简介                   |
| -------------------------------- | ------------------------- |
| AT+GPIO_PIN_WRITE                | 操作一个GPIO，使其输出     |
| AT+GPIO_PIN_READ                 | 操作一个GPIO,使其输入      |
| AT+GPIO_INTERRUPT_CAPTURE        | GPIO的中断捕获             |
| AT+GPIO_INTERRUPT_TRIGGER        | GPIO的中断触发             |
| AT+GPIO_INTERFACE                | GPIO模块的接口测试             |

### 参数列表
以下是GPIO模块对应的AT测试命令共用参数的简要介绍。

| 参数名字      | 释义                                              | 取值范围                                                     |
| ------------- | ------------------------------------------------- | ------------------------------------------------------------ |
| pin           | 表示单个引脚，查看pin_name.h中对应引脚的enum值       | 0 - 31                                                       |
| pin_mask      | 表示多个引脚,比如0x3表示该端口的第1个和第二个引脚     | 0x0 - 0xFF                                                   |
| gpio_mode     | 表示gpio使用那种模式                         | 0:PULLNULL模式<br>1:PULLUP模式<br>2:PULLDOWN模式<br>3:OPEN_DRAIN模式<br>4:PUSH_PULL模式 |
| pin_value     | 表示gpio的电平状态                                | 0:低电平<br>1:高电平                                         |
| delay_ms      | 表示延时的时间(单位ms)                            | 0x0 - 0xFFFF                                                 |
| gpio_irq_mode | 表示GPIO的中断模式                                | 0:上升沿<br>1:下降沿<br>2:双边沿<br>3:低电平<br>4:高电平     |

### 命令详解

### AT+ADC_INTERFACE
| 命令格式 | AT+GPIO_INTERFACE                                             |
| -------- | ------------------------------------------------------------ |
| 命令功能 | GPIO模块接口测试。该命令将会测试GPIO模块下所有的CSI 接口， 测试CSI接口时将会传入异常值、非法值，验证CSI接口返回值是否符合期望 |
| 命令参数 | 无                                                           |
| 示例     | 发送命令AT+GPIO_INTERFACE到A板，测试完成后， 测试板对应串口会打印OK；否则测试失败 |

#### AT+GPIO_PIN_WRITE
| 命令格式 | AT+GPIO_PIN_WRITE=pin,gpio_mode, pin_value,delay_ms |
|----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 命令功能 | 配置pin这个引脚为gpio_mode模式, 当配置完成后输出一个pin_value 状态的电平并维持后delay_ms毫秒 |
| 可搭配的辅助测试命令 | AT+GPIO_PIN_READ |
| 示例 | 把A板的PA24和B板的PA25这两个引脚使用杜邦线连接, 然后按照下列步骤进行测试<br>步骤1:配置A板的PA0引脚作为GPIO的功能,向A板发送下列命令<br>    AT+PINMUX_CONFIG=28,4<br>步骤2:配置B板的PA25引脚作为GPIO的功能,向B板发送下列命令<br>    AT+PINMUX_CONFIG=29,4<br>步骤3:向A板发送测试GPIO写的命令<br>    AT+GPIO_PIN_WRITE=28,0,1,2000<br>步骤4:向B板发送GPIO读的命令<br>    AT+GPIO_PIN_READ=28,0,1 |
| 备注 | 由于步骤3是持续输出2秒的电平状态,所以步骤4中GPIO读的命令必须在步骤3描述的命令发出后打印OK以后发出 |

#### AT+GPIO_PIN_READ
| 命令格式 | AT+GPIO_PIN_READ=pin,gpio_mode,pin_value |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 命令功能 | 配置pin这个引脚为gpio_mode模式, 当配置完成后读取该引脚的输入状态值,并同pin_value做比较,如果相同则向PC机返回OK |
| 可搭配的辅助测试命令 | AT+GPIO_PIN_WRITE |
| 示例 | 参考AT+GPIO_PIN_WRITE示例 |


#### AT+GPIO_INTERRUPT_CAPTURE
| 命令格式 | AT+GPIO_INTERRUPT_CAPTURE=pin_mask,gpio_mode,gpio_irq_mode |
|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 命令功能 | 配置pin_mask描述的多个引脚为gpio_mode模式和捕获的中断为gpio_irq_mode模式 |
| 可搭配的辅助测试命令 | AT+GPIO_INTERRUPT_TRIGGER |
| 示例 | 把A板的PA和B板的PA这两个引脚使用杜邦线连接, 把A板的PA和B板的PA 互接,然后按照下列步骤进行测试<br/>步骤1:配置A板的PA和PA引脚作为GPIO的功能,向A板发送下列命令<br/>    AT+PINMUX_CONFIG=,4<br/>    AT+PINMUX_CONFIG=,4<br/>步骤2:配置B板的PA1和PA3引脚作为GPIO的功能,向B板发送下列命令<br/>    AT+PINMUX_CONFIG=,4<br/>    AT+PINMUX_CONFIG=,4<br/>步骤3:向A板发送测试GPIO信号触发的命令<br/>    AT+GPIO_INTERRUPT_TRIGGER=,0,0,2000<br/>步骤4:向B板发送GPIO捕获中断信号的命令<br/>AT+GPIO_INTERRUPT_TRIGGER=3,0,1 |
| 备注 | 由于步骤3是延时2秒后输出信号,所以步骤4中GPIO捕获中断的命令必须在步骤3描述的命令发出后发出 |

#### AT+GPIO_INTERRUPT_TRIGGER
| 命令格式 | AT+GPIO_INTERRUPT_TRIGGER=pin_mask,gpio_mode,gpio_irq_mode,delay_ms |
|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 命令功能 | 配置pin_mask描述的多个引脚为gpio_mode模式,并在配置完成延时delay_ms毫秒后,产生gpio_irq_mode中断模式所需的信号 |
| 可搭配的辅助测试命令 | AT+GPIO_INTERRUPT_CAPTURE |
| 示例 | 参考AT+GPIO_INTERRUPT_TRIGGER示例 |